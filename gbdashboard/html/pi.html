<!DOCTYPE html>
<html lang="en">
<head>
    <script src="scripts/requests.js"></script>
    <meta charset="UTF-8">
    <title>RPi</title>
</head>
<body>
<script>
    function getSelectedCamera(){
        return parseInt(document.getElementById('camera').value);
    }
    function getSelectedThreshold(){
        let elem = document.getElementById('thresholds');
        return elem.options[elem.selectedIndex].value;
    }
    function getInputThresholdCode(){
        return document.getElementById('threshold_code').value;
    }
    function setFeedCamera(){
        get('/set_feed_camera', {camera: getSelectedCamera()});
    }
    function leds(state){
        get('/set_leds', {state:state});
    }
    function exposure(state){
        get('/set_exposure', {raw:(state?11:10), camera:getSelectedCamera()})
    }
    function autoExposure(state){
        get('/set_auto_exposure', {raw:(state?3:1), camera:getSelectedCamera()})
    }
    function startVisionMaster(){
        get('/start_vision_master')
    }
    function startGBVisionStream(button){
        button.disabled = true;
        let callback = function(){button.disabled = false;}
        get('/start_gbvision_stream', null, callback, callback);
    }
    function setVisionAlgorithm(algo){
        get('/set_vision_algorithm', {algo: algo})
    }
    function setThresholdValue(){
        get('/set_threshold_value', {name: getSelectedThreshold(), code: getInputThresholdCode()});
    }
    get('/get_algorithms_list', null, function(response){
        let lst = JSON.parse(response);
        let elem = document.getElementById("algorithms");
        for(var i in lst){
            elem.innerHTML += '<option value="' + lst[i] + '">' + lst[i] + '</option>';
        }
    })
    get('/get_all_thresholds', null, function(response){
        let lst = JSON.parse(response);
        let elem = document.getElementById("thresholds");
        for(var i in lst){
            elem.innerHTML += '<option value="' + lst[i] + '">' + lst[i] + '</option>';
        }
    })

</script>
<table>
    <tr>
        <th>
            Camera <input type="number" value="0" width="20px" id="camera" onchange="setFeedCamera()">
        </th>
    </tr>
    <tr>
        <th>
            Led Ring <input type="checkbox" onclick="leds(this.checked)">
        </th>
    </tr>
    <tr>
        <th>
            Exposure <input type="checkbox" onclick="exposure(this.checked)"><br>
        </th>
    </tr>
    <tr>
        <th>
            Auto Exposure <input type="checkbox" onclick="autoExposure(this.checked)"><br>
        </th>
    </tr>
    <tr>
        <th>
            <button type="button" onclick="startVisionMaster()">Start Vision Master</button>
        </th>
    </tr>
    <tr>
        <th>
            Algorithm: <select id="algorithms"
                               onchange="setVisionAlgorithm(this.options[this.selectedIndex].value)"></select>
        </th>
    </tr>
    <tr>
        <th>
            <button type="button" onclick="startGBVisionStream(this)">Start Python Stream</button>
        </th>
    </tr>
    <tr>
        <th>
            Set Threshold: <select id="thresholds"></select> <input type="text" id="threshold_code">
            <button onclick="setThresholdValue()">Set!</button>
        </th>
    </tr>
    <tr>
        <th>
            <img id="feed" src="/video_feed">
        </th>
    </tr>
</table>
</body>
</html>